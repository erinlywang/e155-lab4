/*********************************************************************
*                    SEGGER Microcontroller GmbH                     *
*                        The Embedded Experts                        *
**********************************************************************

-------------------------- END-OF-HEADER -----------------------------

File    : main.c
Author  : Erin Wang
Date    : 9/27/2025
Purpose : Play music notes on an LM386 speaker given an input note
          frequency and note duration

*/

#include <stdio.h>

#include <STM32L432KC_FLASH.h>
#include "STM32L432KC_GPIO.h"
#include "STM32L432KC_RCC.h"
#include "STM32L432KC_TIMX.h"

const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};

const int sodapop[][2] = {
  {659, 250},
  {784, 250},
  {659, 250},
  {587, 250},
  {523, 500},
  {440, 500},
  {659, 250},
  {784, 250},
  {659, 250},
  {587, 250},
  {523, 500},
  {440, 500},
  {0, 500},
  {659, 125},
  {0, 125},
  {659, 125},
  {0, 125},
  {523, 125},
  {0, 125},
  {523, 125},
  {0, 125},
  {587, 500},
  {659, 125},
  {0, 125},
  {659, 63},
  {0, 62},
  {659, 63},
  {0, 62},
  {523, 125},
  {0, 125},
  {523, 125},
  {0, 125},
  {523, 500},
  {0,0}};
/*********************************************************************
*
*       main()
*
*  Function description
*   Application entry point.
*/

int main(void) {
    // Configure flash to add waitstates to avoid timing errors
    configureFlash();

    // Setup the PLL and switch clock source to the PLL
    configureClock();

    // Enable GPIO Port A
    RCC -> AHB2ENR |= (1 << 0);

    // Enable timer 15 and 16
    RCC -> APB2ENR |= (1 << 16);
    RCC -> APB2ENR |= (1 << 17);

    initTIM16PWMTOPIN6();
    
    // Initialize TIM15 as PWM and TIM16 as delay
    initTIMPWM(TIM16);
    initTIM(TIM15);

    // Create a for loop
    int furelise_song_length = sizeof(notes) / sizeof(notes[0]);
    int sodapop_song_length = sizeof(sodapop) / sizeof(sodapop[0]);

    for (int i = 0; i <= sodapop_song_length; i++) {
          TIM_outPWM(TIM16, sodapop[i][0]);
          delay_millis(TIM15, sodapop[i][1]);
    }

    //for (int i = 0; i <= furelise_song_length; i++) {
          //TIM_outPWM(TIM16, notes[i][0]);
          //delay_millis(TIM15, notes[i][1]);
    //}
}


/*************************** End of file ****************************/
